<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Printed Concrete - Universal Cost Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Modern and Professional Styling */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif; /* Changed font to Inter */
            background-color: #EAEFF5; /* Lighter, more professional background */
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top */
        }
        
        .container {
            max-width: 1400px;
            width: 100%; /* Ensure it takes full width within padding */
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            background: #FFFFFF; /* Solid white background */
            padding: 30px;
            border-radius: 12px; /* Slightly less rounded */
            box-shadow: 0 8px 24px rgba(0,0,0,0.08); /* Softer shadow */
        }
        
        .header h1 {
            color: #2C3E50;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #4A90E2, #6A5ACD); /* Professional blue gradient */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex; /* Use flex to align icon and text */
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .header h1 .icon {
            font-size: 1.2em;
            -webkit-text-fill-color: #4A90E2;
        }
        
        .company-info {
            color: #666666;
            font-size: 14px;
            margin-top: 10px;
        }
        
        .project-input, .section {
            background: #FFFFFF;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.06);
            margin-bottom: 25px;
            transition: all 0.3s ease;
        }

        .project-input:hover, .section:hover {
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .project-input h3, .section-header {
            color: #333333;
            margin-bottom: 20px;
            font-size: 1.3em;
            font-weight: 600;
        }
        
        .section-header {
            background: #4A90E2;
            color: white;
            padding: 18px 25px;
            border-radius: 12px 12px 0 0;
            margin: -25px -25px 20px -25px;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        .input-group label {
            color: #333333;
            font-weight: 500;
            margin-bottom: 8px;
        }
        
        .input-group input, .input-group select {
            padding: 12px;
            border: 1px solid #D1D9E0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s ease-in-out;
            color: #333333;
            background-color: #FDFDFD;
        }
        
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #4A90E2;
            box-shadow: 0 0 0 4px rgba(74, 144, 226, 0.2);
            background-color: #FFFFFF;
        }
        
        .printer-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .printer-card {
            border: 1px solid #D1D9E0;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            position: relative;
            background-color: #F8F9FA;
            box-shadow: 0 4px 10px rgba(0,0,0,0.04);
        }
        
        .printer-card:hover {
            border-color: #4A90E2;
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(74, 144, 226, 0.15);
        }
        
        .printer-card.selected {
            border-color: #4A90E2;
            background-color: #E6F0FA;
            box-shadow: 0 8px 16px rgba(74, 144, 226, 0.25);
        }

        .printer-card.selected::after {
            content: '‚úîÔ∏è';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5em;
            color: #4A90E2;
        }
        
        .printer-name {
            font-size: 1.1em;
            font-weight: bold;
            color: #333333;
            margin-bottom: 15px;
        }
        
        .pricing-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .pricing-option {
            text-align: center;
            padding: 12px;
            border: 1px solid #E0E6ED;
            border-radius: 8px;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            position: relative;
            background-color: #FFFFFF;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }
        
        .pricing-option:hover {
            background-color: #F0F4F8;
            box-shadow: 0 4px 8px rgba(0,0,0,0.06);
        }
        
        .pricing-option.selected {
            background: #4A90E2;
            color: white;
            border-color: #4A90E2;
            box-shadow: 0 4px 12px rgba(74, 144, 226, 0.2);
        }

        .pricing-option.selected::after {
            content: '‚úîÔ∏è';
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 1.0em;
            color: white;
        }
        
        .price-amount {
            font-size: 1em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
.price-label {
            font-size: 0.8em;
            opacity: 0.9;
        }
        
        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            border: 1px solid #E0E6ED;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            background-color: #FFFFFF;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #E0E6ED;
        }
        
        th {
            background-color: #F8F9FA;
            color: #333333;
            font-weight: 600;
        }
        
        tr:last-child td {
            border-bottom: none;
        }

        .editable {
            background-color: #FFFCEE;
            border: 1px solid #FFEDC2;
            padding: 8px;
            border-radius: 5px;
            width: 100%;
            /* Increased max-width for better display of larger numbers */
            max-width: 140px; /* Adjusted from 100px */
            /* Align numeric inputs to the right for better readability */
            text-align: right; /* Changed from center */
            color: #6C5400;
            transition: all 0.2s ease-in-out;
        }

        .editable:focus {
            box-shadow: 0 0 0 3px rgba(255, 204, 102, 0.3);
            border-color: #FFCC66;
        }
        
        .calculated {
            background-color: #EBF8E8;
            color: #1A7036;
            font-weight: 600;
            padding: 8px;
            border-radius: 5px;
        }
        
        .total-row {
            background-color: #F0F4FA;
            font-weight: bold;
        }
        
        .summary-section .section-header {
            background: #6A5ACD;
        }

        .summary-section table {
            table-layout: fixed;
            width: 100%;
        }

        .summary-section table th:nth-child(1) { width: 18%; }
        .summary-section table th:nth-child(2) { width: 32%; }
        .summary-section table th:nth-child(3) { width: 18%; }
        .summary-section table th:nth-child(4) { width: 18%; }
        .summary-section table th:nth-child(5) { width: 14%; }


        .summary-section table th,
        .summary-section table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #E0E6ED;
        }

        .summary-section table th {
            background-color: #7E74D4;
            color: white;
        }

        .summary-section tbody td {
            padding: 0;
            vertical-align: middle;
        }
        
        .summary-section tbody td > div {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            width: 100%;
            height: 100%;
            padding: 12px;
            box-sizing: border-box;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #333333;
        }

        .summary-section tbody td:nth-child(2) > div {
            justify-content: flex-start;
        }

        .summary-section td.calculated[id$="_percentage"] > div {
            justify-content: flex-end;
            font-weight: bold;
        }

        .summary-section .total-row td > div {
            color: #1A202C;
        }
        
        .cost-per-cubic {
            background: linear-gradient(135deg, #1ABC9C, #2ECC71);
            color: white;
            padding: 25px;
            text-align: center;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
        }
        
        .cost-per-cubic h2 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .cost-per-cubic .amount {
            font-size: 3.2em;
            font-weight: bold;
            margin: 10px 0;
            letter-spacing: -1px;
        }
        
        .btn {
            background: linear-gradient(135deg, #4A90E2, #6A5ACD);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(74, 144, 226, 0.3);
        }
        
        .alert {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 0.9em;
        }
        
        .alert-info {
            background: #E0F2F7;
            border: 1px solid #BEEBF9;
            color: #0A608F;
        }

        .disabled-row {
            opacity: 0.6;
            background-color: #f5f5f5;
        }

        .disabled-row input[type="number"],
        .disabled-row select {
            background-color: #e0e0e0;
            cursor: not-allowed;
        }
        
        .use-checkbox {
            margin-left: 10px;
            transform: scale(1.2);
            cursor: pointer;
            vertical-align: middle;
        }

        @media print {
            body {
                background-color: #fff;
                padding: 0;
                margin: 0;
                font-family: 'Inter', sans-serif;
            }
            .container {
                box-shadow: none;
                max-width: 100%;
            }
            .header, .project-input, .section, .cost-per-cubic {
                box-shadow: none;
                border-radius: 0;
                margin-bottom: 10px;
                padding: 10px;
            }
            .header h1 {
                -webkit-print-color-adjust: exact;
                color: #2C3E50;
                font-size: 2em;
                gap: 5px;
            }
            .section-header {
                -webkit-print-color-adjust: exact;
                background: #4A90E2 !important;
                color: white !important;
                border-radius: 0;
                margin: -10px -10px 10px -10px;
                padding: 10px;
                font-size: 1.1em;
                gap: 5px;
            }
            .alert, .print-button, .use-checkbox, 
            .input-group input:not([readonly]):not([type="checkbox"]),
            .input-group select {
                display: none !important;
            }

            .input-group input[readonly] {
                display: block !important;
                background-color: transparent !important;
                border: none !important;
                padding: 0 !important;
                box-shadow: none !important;
                color: #000 !important;
                text-align: left !important;
                width: auto !important;
                max-width: none !important;
            }

            .input-group label {
                font-weight: bold;
                color: #000;
                display: block !important;
                margin-bottom: 0px !important;
            }
            
            .calculated {
                display: block !important;
                background-color: transparent !important;
                border: none !important;
                padding: 0 !important;
                box-shadow: none !important;
                color: #000 !important;
                text-align: right !important;
                width: auto !important;
            }

            table {
                break-inside: avoid;
                page-break-inside: avoid;
                width: 100%;
            }
            table tr {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
            }

            .section {
                page-break-inside: avoid !important;
                page-break-before: auto !important;
                break-inside: avoid !important;
            }

            th, td {
                border-color: #ccc !important;
                padding: 8px !important;
                vertical-align: top !important;
                color: #000 !important;
            }

            .summary-section table th {
                text-align: center !important;
                background-color: #7E74D4 !important;
                color: white !important;
            }

            .summary-section table th:nth-child(1) { width: 18% !important; }
            .summary-section table td:nth-child(1) { width: 18% !important; text-align: left !important; }

            .summary-section table th:nth-child(2) { width: 32% !important; }
            .summary-section table td:nth-child(2) { width: 32% !important; text-align: left !important; white-space: normal !important; }

            .summary-section table th:nth-child(3) { width: 18% !important; }
            .summary-section table td:nth-child(3) { width: 18% !important; text-align: right !important; }

            .summary-section table th:nth-child(4) { width: 18% !important; }
            .summary-section table td:nth-child(4) { width: 18% !important; text-align: right !important; }

            .summary-section table th:nth-child(5) { width: 14% !important; }
            .summary-section table td:nth-child(5) { width: 14% !important; text-align: right !important; }

            #material_qty_summary_tbody th:nth-child(1),
            #material_qty_summary_tbody td:nth-child(1) {
                width: 40% !important;
                text-align: left !important;
            }
            #material_qty_summary_tbody th:nth-child(2),
            #material_qty_summary_tbody td:nth-child(2) {
                width: 30% !important;
                text-align: right !important;
            }
            #material_qty_summary_tbody th:nth-child(3),
            #material_qty_summary_tbody td:nth-child(3) {
                width: 30% !important;
                text-align: right !important;
            }

            .summary-section .total-row td {
                color: #000 !important;
                font-weight: bold !important;
            }

            .print-only-project-name {
                display: block !important;
                font-size: 1.5em;
                font-weight: bold;
                color: #000;
                margin-bottom: 10px;
                text-align: center;
            }
            .project-name-input-group {
                display: none !important;
            }
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>3D Printed Concrete - Universal Cost Calculator</h1>
            <div class="company-info">
                PT. ICONIC LIVIN DEVELOPMENT<br>
                Jl. Dewi Sri No.18, Legian, Kuta, Badung - Bali
            </div>
        </div>

        <div class="project-input">
            <h3>üèóÔ∏è Project Parameters</h3>
            <div class="input-grid">
                <div class="input-group project-name-input-group">
                    <label for="project_name">Project Name</label>
                    <input type="text" id="project_name" placeholder="Enter project name" value="Sample Project" onkeyup="updateProjectNameForPrint()">
                </div>
                <span id="print_project_name" class="print-only-project-name" style="display: none;"></span>
                <div class="input-group">
                    <label for="structure_type">Structure Type</label>
                    <select id="structure_type" onchange="calculateAll()">
                        <option value="wall">Wall</option>
                        <option value="column">Column</option>
                        <option value="beam">Beam</option>
                        <option value="slab">Slab</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>
            </div>

            <div class="input-grid mt-4">
                <div class="input-group">
                    <label for="length_mm">Length (mm)</label>
                    <input type="number" id="length_mm" value="4330" step="10" onchange="calculateAll()">
                </div>
                <div class="input-group">
                    <label for="width_mm">Width (mm)</label>
                    <input type="number" id="width_mm" value="170" step="10" onchange="calculateAll()">
                </div>
                <div class="input-group">
                    <label for="height_mm">Height (mm)</label>
                    <input type="number" id="height_mm" value="2000" step="10" onchange="calculateAll()">
                </div>
            </div>

            <div class="input-grid mt-4">
                <div class="input-group">
                    <label for="total_volume">Total Volume (m¬≥)</label>
                    <input type="number" id="total_volume" value="1.00" readonly>
                </div>
                <div class="input-group">
                    <label for="project_duration">Project Duration (days)</label>
                    <input type="number" id="project_duration" value="1" readonly>
                    <span class="text-xs text-gray-500" id="project_duration_hours_minutes"></span>
                </div>
                <div class="input-group">
                    <label for="daily_operating_hours">Printer (Hours)</label>
                    <input type="number" id="daily_operating_hours" value="8" step="1" min="1" max="24" onchange="calculateAll()">
                </div>
            </div>

            <div class="input-grid mt-4">
                <div class="input-group">
                    <label for="nozzle_width">Nozzle Width (mm)</label>
                    <input type="number" id="nozzle_width" value="40" step="1" onchange="calculateAll()">
                </div>
                <div class="input-group">
                    <label for="nozzle_height">Nozzle Height (mm)</label>
                    <input type="number" id="nozzle_height" value="20" step="1" onchange="calculateAll()">
                </div>
            </div>

            <div class="alert alert-info" style="margin-top: 20px;">
                <strong>‚ÑπÔ∏è Note:</strong> Total Volume (m¬≥) is calculated from Length, Width, and Height. Project Duration is automatically calculated based on Total Volume and Daily Operating Hours **for the Printer** (assuming 0.2 m¬≥ material takes 1 hour).
            </div>
        </div>

        <div class="section">
            <div class="section-header">üìê Detailed Printing Geometry (for Ink Cost & Volume Reference)</div>
            <div class="input-grid">
                <div class="input-group">
                    <label for="ink_width_mm">Ink Width (mm)</label>
                    <input type="number" id="ink_width_mm" value="40" step="1" onchange="calculateAll()">
                </div>
                <div class="input-group">
                    <label for="ink_thickness_mm">Ink Thickness (mm)</label>
                    <input type="number" id="ink_thickness_mm" value="20" step="1" onchange="calculateAll()">
                </div>
                <div class="input-group">
                    <label for="contour_length_per_layer_mm">Contour Length per Layer (mm)</label>
                    <input type="number" class="editable" value="1500" step="10" onchange="calculateAll()" id="contour_length_per_layer_mm">
                </div>
                <div class="input-group">
                    <label for="layer_amount">Total Layer Amount</label>
                    <input type="number" class="editable" value="27" step="1" onchange="calculateAll()" id="layer_amount">
                </div>
                <div class="input-group">
                    <label>Total Extrusion Length (m)</label>
                    <div class="calculated" id="total_extrusion_length_m">0 m</div>
                </div>
                <div class="input-group">
                    <label>Calculated Volume from Geometry (m¬≥)</label>
                    <div class="calculated" id="calculated_volume_m3">0 m¬≥</div>
                </div>
                <div class="input-group">
                    <label for="ink_extrusion_cost_per_meter">Cost per Meter Extrusion (Rp/m)</label>
                    <input type="number" class="editable" value="15000" step="1" onchange="calculateAll()" id="ink_extrusion_cost_per_meter">
                </div>
                <div class="input-group">
                    <label>Total Ink Extrusion Cost (Rp)</label>
                    <div class="calculated" id="ink_extrusion_total_cost">Rp 0</div>
                </div>
            </div>
            <div class="alert alert-info" style="margin-top: 20px;">
                <strong>‚ÑπÔ∏è Note:</strong> The "Total Volume (m¬≥)" above is the main input for the overall project. Geometry parameters here are used to calculate ink cost more detailed and provide an alternative volume estimate based on layer dimensions. **This Total Ink Extrusion Cost is for reference and is NOT included in the project total.**
            </div>
        </div>

        <!-- Material Batch Reference Section -->
        <div class="section">
            <div class="section-header">üìö Referensi Komposisi Material Per Batch</div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Material</th>
                            <th>Qty (Kg/L)</th>
                            <th>Volume (m¬≥)</th>
                            <th>Cost (IDR)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Ink Powder</td>
                            <td>20 Kg</td>
                            <td>0.04</td>
                            <td>192.000</td>
                        </tr>
                        <tr>
                            <td>Portland Cement</td>
                            <td>20 Kg</td>
                            <td>0.03</td>
                            <td>27.500</td>
                        </tr>
                        <tr>
                            <td>River Sand</td>
                            <td>60 Kg</td>
                            <td>0.03</td>
                            <td>10.500</td> <!-- Corrected: 60 Kg * 175 Rp/Kg = 10500 -->
                        </tr>
                        <tr>
                            <td>Plastic/Tarpaulin</td>
                            <td>2 Unit</td>
                            <td>N/A</td>
                            <td>19.200</td>
                        </tr>
                        <tr>
                            <td>Water</td>
                            <td>13 L</td>
                            <td>0.05</td>
                            <td>18.200</td>
                        </tr>
                        <tr class="total-row">
                            <td><strong>Total per Batch</strong></td>
                            <td></td>
                            <td>~0.15</td>
                            <td>267.400</td> <!-- Corrected Total: 192000 + 27500 + 10500 + 19200 + 18200 -->
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="alert alert-info" style="margin-top: 20px;">
                <strong>üí° Note:</strong> This table is a fixed reference for the composition of 1 material batch. Material costs in the "Raw Materials" section are calculated based on the project volume input you provide.
            </div>
        </div>

        <!-- Material Quantity Summary Section -->
        <div class="section">
            <div class="section-header">‚öñÔ∏è Material Quantity Summary (Per Project)</div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Material</th>
                            <th>Qty per m¬≥ (from input)</th>
                            <th>Total Quantity (Kg/Unit)</th>
                        </tr>
                    </thead>
                    <tbody id="material_qty_summary_tbody">
                        <!-- Content will be generated by JavaScript -->
                    </tbody>
                </table>
            </div>
            <div class="alert alert-info" style="margin-top: 20px;">
                <strong>üí° Note:</strong> Total quantities are calculated based on your project volume. Use this to estimate logistics and procurement needs.
            </div>
        </div>

        <!-- Printer Selection Section -->
        <div class="section">
            <div class="section-header">üñ®Ô∏è 3D Printer Selection & Equipment Rental</div>
            <div class="printer-selection">
                <h4 style="margin-bottom: 15px; color: #2c3e50;">Select Printer Brand & Rental Option:</h4>
                <div class="printer-cards" id="printer_cards">
                    <!-- Printer cards will be generated by JavaScript -->
                </div>
                <div class="alert alert-info" id="selected_printer_feedback" style="margin-top: 15px;">
                    Currently selected: None
                </div>
                
                <div class="alert alert-info">
                    <strong>üí° Rental Information:</strong> Prices include operator training and basic maintenance. Purchase options include 5-year warranty and full technical support.
                </div>
            </div>
        </div>

        <!-- Materials Section -->
        <div class="section">
            <div class="section-header">üß± Raw Materials (Per Project Volume)</div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Material</th>
                            <th>Description</th>
                            <th>Qty per m¬≥ (calculated)</th>
                            <th>Price per Unit (Rp)</th>
                            <th>Use</th>
                            <th>Total Cost (Rp)</th>
                        </tr>
                    </thead>
                    <tbody id="materials_tbody">
                        <tr>
                            <td>Ink Powder</td>
                            <td>Cost: $600/ton (~9600 IDR/Kg)</td>
                            <td><input type="number" class="editable" data-cost-type="material-qty" value="0" step="0.01" onchange="calculateAll()" id="ink_powder_qty_per_m3" readonly> Kg/m¬≥</td>
                            <td><input type="number" class="editable" data-cost-type="material-price" value="9600" onchange="calculateAll()" id="ink_powder_price_per_kg"> Rp/Kg</td>
                            <td><input type="checkbox" class="use-checkbox" checked onchange="toggleRow(this)"></td>
                            <td class="calculated" id="ink_cost"></td>
                        </tr>
                        <tr>
                            <td>Portland Cement</td>
                            <td>Merk Singa Merah</td>
                            <td><input type="number" class="editable" data-cost-type="material-qty" value="0" step="0.01" onchange="calculateAll()" id="cement_qty_per_m3" readonly> Kg/m¬≥</td>
                            <td><input type="number" class="editable" data-cost-type="material-price" value="1375" onchange="calculateAll()" id="cement_price_per_kg"> Rp/Kg</td>
                            <td><input type="checkbox" class="use-checkbox" checked onchange="toggleRow(this)"></td>
                            <td class="calculated" id="cement_cost"></td>
                        </tr>
                        <tr>
                            <td>River Sand</td>
                            <td>From Karangasem</td>
                            <td><input type="number" class="editable" data-cost-type="material-qty" value="0" step="0.01" onchange="calculateAll()" id="sand_qty_per_m3" readonly> Kg/m¬≥</td>
                            <td><input type="number" class="editable" data-cost-type="material-price" value="175" onchange="calculateAll()" id="sand_price_per_kg"> Rp/Kg</td>
                            <td><input type="checkbox" class="use-checkbox" data-target-inputs=".material-sand-inputs" checked onchange="toggleRow(this)"></td>
                            <td class="calculated" id="sand_cost"></td>
                        </tr>
                        <tr>
                            <td>Plastic/Tarpaulin</td>
                            <td>10% Unit/cost</td>
                            <td><input type="number" class="editable" data-cost-type="material-qty" value="12.5" step="0.1" onchange="calculateAll()" id="plastic_qty_per_unit"> Unit/m¬≥</td>
                            <td><input type="number" class="editable" data-cost-type="material-price" value="9600" onchange="calculateAll()" id="plastic_price_per_unit"> Rp/Unit</td>
                            <td><input type="checkbox" class="use-checkbox" data-target-inputs=".material-plastic-inputs" checked onchange="toggleRow(this)"></td>
                            <td class="calculated" id="plastic_cost"></td>
                        </tr>
                        <tr>
                            <td>Water</td>
                            <td>Clean Water</td>
                            <td><input type="number" class="editable" data-cost-type="material-qty" value="0" step="0.01" onchange="calculateAll()" id="water_qty_per_m3" readonly> L/m¬≥</td>
                            <td><input type="number" class="editable" data-cost-type="material-price" value="1400" onchange="calculateAll()" id="water_price_per_l"> Rp/L</td>
                            <td><input type="checkbox" class="use-checkbox" data-target-inputs=".material-water-inputs" checked onchange="toggleRow(this)"></td>
                            <td class="calculated" id="water_cost"></td>
                        </tr>
                        <tr class="total-row">
                            <td colspan="5"><strong>Total Materials per m¬≥</strong></td>
                            <td class="calculated" id="materials_total"></td>
                        </tr>
                    </tbody>
                </table>
                <button type="button" class="btn add-item-button" onclick="addMaterialRow()">+ Add Material</button>
            </div>
        </div>

        <div class="section">
            <div class="section-header">üîß Sub Materials - Reinforcing Bar</div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Diameter</th>
                            <th>Description</th>
                            <th>Total Length (m)</th>
                            <th>Unit</th>
                            <th>Price per Meter (Rp)</th>
                            <th>Use</th>
                            <th>Total Cost (Rp)</th>
                        </tr>
                    </thead>
                    <tbody id="rebar_tbody">
                        <tr>
                            <td>D 6mm</td>
                            <td>Reinforcing bar</td>
                            <td><input type="number" class="editable" data-cost-type="rebar-length" value="12" step="0.1" onchange="calculateAll()" id="d6_length"></td>
                            <td>Meter</td>
                            <td><input type="number" class="editable" data-cost-type="rebar-price-per-meter" value="5000" onchange="calculateAll()" id="d6_price"></td>
                            <td><input type="checkbox" class="use-checkbox" checked onchange="toggleRow(this)"></td>
                            <td class="calculated" id="d6_cost"></td>
                        </tr>
                        <tr>
                            <td>D 8mm</td>
                            <td>Reinforcing bar</td>
                            <td><input type="number" class="editable" data-cost-type="rebar-length" value="12" step="0.1" onchange="calculateAll()" id="d8_length"></td>
                            <td>Meter</td>
                            <td><input type="number" class="editable" data-cost-type="rebar-price-per-meter" value="5000" onchange="calculateAll()" id="d8_price"></td>
                            <td><input type="checkbox" class="use-checkbox" checked onchange="toggleRow(this)"></td>
                            <td class="calculated" id="d8_cost"></td>
                        </tr>
                        <tr>
                            <td>D 10mm</td>
                            <td>Reinforcing bar</td>
                            <td><input type="number" class="editable" data-cost-type="rebar-length" value="12" step="0.1" onchange="calculateAll()" id="d10_length"></td>
                            <td>Meter</td>
                            <td><input type="number" class="editable" data-cost-type="rebar-price-per-meter" value="6500" onchange="calculateAll()" id="d10_price"></td>
                            <td><input type="checkbox" class="use-checkbox" checked onchange="toggleRow(this)"></td>
                            <td class="calculated" id="d10_cost"></td>
                        </tr>
                        <tr>
                            <td>D 12mm</td>
                            <td>Reinforcing bar</td>
                            <td><input type="number" class="editable" data-cost-type="rebar-length" value="12" step="0.1" onchange="calculateAll()" id="d12_length"></td>
                            <td>Meter</td>
                            <td><input type="number" class="editable" data-cost-type="rebar-price-per-meter" value="12700" onchange="calculateAll()" id="d12_price"></td>
                            <td><input type="checkbox" class="use-checkbox" checked onchange="toggleRow(this)"></td>
                            <td class="calculated" id="d12_cost"></td>
                        </tr>
                        <tr>
                            <td>D 16mm</td>
                            <td>Reinforcing bar</td>
                            <td><input type="number" class="editable" data-cost-type="rebar-length" value="12" step="0.1" onchange="calculateAll()" id="d16_length"></td>
                            <td>Meter</td>
                            <td><input type="number" class="editable" data-cost-type="rebar-price-per-meter" value="12400" onchange="calculateAll()" id="d16_price"></td>
                            <td><input type="checkbox" class="use-checkbox" checked onchange="toggleRow(this)"></td>
                            <td class="calculated" id="d16_cost"></td>
                        </tr>
                        <tr>
                            <td>D 22mm</td>
                            <td>Reinforcing bar</td>
                            <td><input type="number" class="editable" data-cost-type="rebar-length" value="12" step="0.1" onchange="calculateAll()" id="d22_length"></td>
                            <td>Meter</td>
                            <td><input type="number" class="editable" data-cost-type="rebar-price-per-meter" value="15000" onchange="calculateAll()" id="d22_price"></td>
                            <td><input type="checkbox" class="use-checkbox" checked onchange="toggleRow(this)"></td>
                            <td class="calculated" id="d22_cost"></td>
                        </tr>
                        <tr class="total-row">
                            <td colspan="6"><strong>Total Reinforcement Cost</strong></td>
                            <td class="calculated" id="rebar_total"></td>
                        </tr>
                    </tbody>
                </table>
                <button type="button" class="btn add-item-button" onclick="addRebarRow()">+ Add Rebar Type</button>
            </div>
        </div>

        <div class="section">
            <div class="section-header">üöö Additional Equipment & Rentals</div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Equipment Description</th>
                            <th>Duration (Units)</th>
                            <th>Unit Type</th>
                            <th>Rate per Unit (Rp)</th>
                            <th>Use</th>
                            <th>Total Cost (Rp)</th>
                        </tr>
                    </thead>
                    <tbody id="equipment_tbody">
                        <tr class="subheader-row">
                            <td colspan="6" style="background-color: #F0F4FA; font-weight: bold; text-align: center;">Distribution</td>
                        </tr>
                        <tr>
                            <td>Mobile Crane</td>
                            <td><input type="number" class="editable" data-cost-type="equipment-qty" value="8" onchange="calculateAll()" id="crane_qty"></td>
                            <td>Hours</td>
                            <td><input type="number" class="editable" data-cost-type="equipment-rate" value="812500" onchange="calculateAll()" id="crane_rate"></td>
                            <td><input type="checkbox" class="use-checkbox" checked onchange="toggleRow(this)"></td>
                            <td class="calculated" id="crane_cost"></td>
                        </tr>
                        <tr>
                            <td>Truck Crane</td>
                            <td><input type="number" class="editable" data-cost-type="equipment-qty" value="8" onchange="calculateAll()" id="crane_qty"></td>
                            <td>Hours</td>
                            <td><input type="number" class="editable" data-cost-type="equipment-rate" value="500000" onchange="calculateAll()" id="crane_rate"></td>
                            <td><input type="checkbox" class="use-checkbox" checked onchange="toggleRow(this)"></td>
                            <td class="calculated" id="crane_cost"></td>
                        </tr>
                        <tr>
                            <td>Truck</td>
                            <td><input type="number" class="editable" data-cost-type="equipment-qty" value="8" onchange="calculateAll()" id="truck_rental_qty"></td>
                            <td>Hours</td>
                            <td><input type="number" class="editable" data-cost-type="equipment-rate" value="375000" onchange="calculateAll()" id="truck_rental_rate"></td>
                            <td><input type="checkbox" class="use-checkbox" checked onchange="toggleRow(this)"></td>
                            <td class="calculated" id="truck_rental_cost"></td>
                        </tr>
                        <tr>
                            <td>Forklif</td>
                            <td><input type="number" class="editable" data-cost-type="equipment-qty" value="8" onchange="calculateAll()" id="truck_rental_qty"></td>
                            <td>Hours</td>
                            <td><input type="number" class="editable" data-cost-type="equipment-rate" value="275000" onchange="calculateAll()" id="truck_rental_rate"></td>
                            <td><input type="checkbox" class="use-checkbox" checked onchange="toggleRow(this)"></td>
                            <td class="calculated" id="truck_rental_cost"></td>
                        </tr>
                        <tr>
                            <td>Pickup</td>
                            <td><input type="number" class="editable" data-cost-type="equipment-qty" value="1" onchange="calculateAll()" id="pickup_rental_qty"></td>
                            <td>Trip</td>
                            <td><input type="number" class="editable" data-cost-type="equipment-rate" value="450000" onchange="calculateAll()" id="pickup_rental_rate"></td>
                            <td><input type="checkbox" class="use-checkbox" checked onchange="toggleRow(this)"></td>
                            <td class="calculated" id="pickup_rental_cost"></td>
                        </tr>
                        <tr class="subheader-row">
                            <td colspan="6" style="background-color: #F0F4FA; font-weight: bold; text-align: center;">Tools</td>
                        </tr>
                        <tr>
                            <td>Concrete Mixer Rental (manual casting)</td>
                            <td><input type="number" class="editable" data-cost-type="equipment-qty" value="24" onchange="calculateAll()" id="mixer_qty"></td>
                            <td>Hours</td>
                            <td><input type="number" class="editable" data-cost-type="equipment-rate" value="20833" onchange="calculateAll()" id="mixer_rate"></td>
                            <td><input type="checkbox" class="use-checkbox" checked onchange="toggleRow(this)"></td>
                            <td class="calculated" id="mixer_cost"></td>
                        </tr>
                        <tr>
                            <td>Compressor for Equipment Rental</td>
                            <td><input type="number" class="editable" data-cost-type="equipment-qty" value="24" onchange="calculateAll()" id="compressor_qty"></td>
                            <td>Hours</td>
                            <td><input type="number" class="editable" data-cost-type="equipment-rate" value="8333" onchange="calculateAll()" id="compressor_rate"></td>
                            <td><input type="checkbox" class="use-checkbox" checked onchange="toggleRow(this)"></td>
                            <td class="calculated" id="compressor_cost"></td>
                        </tr>
                        <tr>
                            <td>Angle Grinder</td>
                            <td><input type="number" class="editable" data-cost-type="equipment-qty" value="24" onchange="calculateAll()" id="grinder_qty"></td>
                            <td>Hours</td>
                            <td><input type="number" class="editable" data-cost-type="equipment-rate" value="8333" onchange="calculateAll()" id="grinder_rate"></td>
                            <td><input type="checkbox" class="use-checkbox" checked onchange="toggleRow(this)"></td>
                            <td class="calculated" id="grinder_cost"></td>
                        </tr>
                        <tr>
                            <td>Brushless Drill</td>
                            <td><input type="number" class="editable" data-cost-type="equipment-qty" value="1" onchange="calculateAll()" id="drill_qty"></td>
                            <td>Unit</td>
                            <td><input type="number" class="editable" data-cost-type="equipment-rate" value="100000" onchange="calculateAll()" id="drill_rate"></td>
                            <td><input type="checkbox" class="use-checkbox" checked onchange="toggleRow(this)"></td>
                            <td class="calculated" id="drill_cost"></td>
                        </tr>
                        <tr class="subheader-row">
                            <td colspan="6" style="background-color: #F0F4FA; font-weight: bold; text-align: center;">Other Sub-Rentals & Consumables</td>
                        </tr>
                        <tr>
                            <td>Fuel & Power Consumption</td>
                            <td><input type="number" class="editable" data-cost-type="equipment-qty" value="24" onchange="calculateAll()" id="fuel_qty"></td>
                            <td>Hours</td>
                            <td><input type="number" class="editable" data-cost-type="equipment-rate" value="12500" onchange="calculateAll()" id="fuel_rate"></td>
                            <td><input type="checkbox" class="use-checkbox" checked onchange="toggleRow(this)"></td>
                            <td class="calculated" id="fuel_cost"></td>
                        </tr>
                        <tr class="total-row">
                            <td colspan="5"><strong>Subtotal Equipment</strong></td>
                            <td class="calculated" id="equipment_total"></td>
                        </tr>
                    </tbody>
                </table>
                <button type="button" class="btn add-item-button" onclick="addEquipmentRow()">+ Add Equipment</button>
            </div>
        </div>

        <div class="section">
            <div class="section-header">üë∑ Labor Cost</div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Position</th>
                            <th>Description</th>
                            <th>Quantity</th>
                            <th>Time (Minutes/Day)</th>
                            <th>Rate per Hour (Rp)</th>
                            <th>Use</th>
                            <th>Total Cost (Rp)</th>
                        </tr>
                    </thead>
                    <tbody id="labor_tbody">
                        <tr>
                            <td>Field Workers</td>
                            <td>250K IDR / 8 Hours</td>
                            <td><input type="number" class="editable" data-cost-type="labor-qty" value="2" onchange="calculateAll()" id="workers_qty"></td>
                            <td><input type="number" class="editable" data-cost-type="labor-time" value="480" onchange="calculateAll()" id="workers_time"></td>
                            <td><input type="number" class="editable" data-cost-type="labor-rate" value="31250" onchange="calculateAll()" id="workers_rate"></td>
                            <td><input type="checkbox" class="use-checkbox" checked onchange="toggleRow(this)"></td>
                            <td class="calculated" id="workers_cost"></td>
                        </tr>
                        <tr>
                            <td>Leader</td>
                            <td>500K IDR / 8 Hours</td>
                            <td><input type="number" class="editable" data-cost-type="labor-qty" value="1" onchange="calculateAll()" id="supervisor_qty"></td>
                            <td><input type="number" class="editable" data-cost-type="labor-time" value="480" onchange="calculateAll()" id="supervisor_time"></td>
                            <td><input type="number" class="editable" data-cost-type="labor-rate" value="62500" onchange="calculateAll()" id="supervisor_rate"></td>
                            <td><input type="checkbox" class="use-checkbox" checked onchange="toggleRow(this)"></td>
                            <td class="calculated" id="supervisor_cost"></td>
                        </tr>
                        <tr>
                            <td>Daily Workers (Load/Unload)</td>
                            <td>200K IDR / 8 Hours</td>
                            <td><input type="number" class="editable" data-cost-type="labor-qty" value="0" onchange="calculateAll()" id="daily_workers_qty"></td>
                            <td><input type="number" class="editable" data-cost-type="labor-time" value="480" onchange="calculateAll()" id="daily_workers_time"></td>
                            <td><input type="number" class="editable" data-cost-type="labor-rate" value="25000" onchange="calculateAll()" id="daily_workers_rate"></td>
                            <td><input type="checkbox" class="use-checkbox" checked onchange="toggleRow(this)"></td>
                            <td class="calculated" id="daily_workers_cost"></td>
                        </tr>
                        <tr class="total-row">
                            <td colspan="6"><strong>Total Labor Cost</strong></td>
                            <td class="calculated" id="labor_total"></td>
                        </tr>
                    </tbody>
                </table>
                <button type="button" class="btn add-item-button" onclick="addLaborRow()">+ Add Labor Position</button>
            </div>
        </div>

        <div class="cost-per-cubic">
            <h2>üí∞ Cost per Cubic Meter (m¬≥)</h2>
            <div class="amount" id="cost_per_cubic">Rp 0</div>
            <p>Total project volume: <span id="display_volume">1.00</span> m¬≥</p>
        </div>

        <div class="section summary-section">
            <div class="section-header">üìä Project Cost Summary</div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Description</th>
                            <th>Cost per m¬≥ (Rp)</th>
                            <th>Project Total (Rp)</th>
                            <th>Percentage</th>
                        </tr>
                    </thead>
                    <tbody id="summary_tbody">
                        <tr>
                            <td>3D Printer</td>
                            <td id="selected_printer_summary">Not Selected</td>
                            <td class="calculated" id="printer_per_cubic">0</td>
                            <td class="calculated" id="printer_project_total">0</td>
                            <td class="calculated" id="printer_percentage">0%</td>
                        </tr>
                        <tr>
                            <td>Equipment & Rentals</td>
                            <td>Additional equipment and tools</td>
                            <td class="calculated" id="equipment_per_cubic">0</td>
                            <td class="calculated" id="equipment_project_total">0</td>
                            <td class="calculated" id="equipment_percentage">0%</td>
                        </tr>
                        <tr>
                            <td>Raw Materials</td>
                            <td>Concrete mix components</td>
                            <td class="calculated" id="materials_per_cubic">0</td>
                            <td class="calculated" id="materials_project_total">0</td>
                            <td class="calculated" id="materials_percentage">0%</td>
                        </tr>
                        <tr>
                            <td>Labor</td>
                            <td>Workers and supervision</td>
                            <td class="calculated" id="labor_per_cubic">0</td>
                            <td class="calculated" id="labor_project_total">0</td>
                            <td class="calculated" id="labor_percentage">0%</td>
                        </tr>
                        <tr>
                            <td>Reinforcement</td>
                            <td>Steel bars and accessories</td>
                            <td class="calculated" id="rebar_per_cubic">0</td>
                            <td class="calculated" id="rebar_project_total">0</td>
                            <td class="calculated" id="rebar_percentage">0%</td>
                        </tr>
                        <tr class="total-row">
                            <td><strong>PROJECT TOTAL</strong></td>
                            <td><strong>Complete 3D Printed Structure</strong></td>
                            <td class="calculated" id="grand_total_per_cubic">0</td>
                            <td class="calculated" id="grand_total_project">0</td>
                            <td class="calculated" id="grand_total_percentage">100%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <button onclick="window.print()" class="btn print-button">üñ®Ô∏è Cetak Laporan</button>
    </div>

    <script>
        // Function to update the hidden span for printing Project Name
        function updateProjectNameForPrint() {
            const projectNameInput = document.getElementById('project_name');
            const printProjectNameSpan = document.getElementById('print_project_name');
            if (projectNameInput && printProjectNameSpan) {
                printProjectNameSpan.textContent = projectNameInput.value;
            }
        }

        // Data for available printers and their rental/purchase options
        const PRINTERS = [
            {
                name: "Win Sun",
                options: [
                    { label: "Hourly Rental (per hour)", rate: 148625, unit: "hour" },
                    { label: "8-Hour Rental (per day)", rate: 3567000 / 3, unit: "8-hour" },
                    { label: "Daily Rental (24h)", rate: 3567000, unit: "day" },
                    { label: "Monthly Rental", rate: 108520000, unit: "month" },
                    { label: "Yearly Rental", rate: 1302240000, unit: "year" },
                    { label: "Purchase (5 Years)", rate: 6511200000, unit: "one-time" }
                ]
            },
            {
                name: "GearBuild",
                options: [
                    { label: "Hourly Rental (per hour)", rate: 64057, unit: "hour" },
                    { label: "8-Hour Rental (per day)", rate: 1537367 / 3, unit: "8-hour" },
                    { label: "Daily Rental (24h)", rate: 1537367, unit: "day" }, 
                    { label: "Monthly Rental", rate: 46121000, unit: "month" },
                    { label: "Yearly Rental", rate: 553425000, unit: "year" },
                    { label: "Purchase (5 Years)", rate: 2767260000, unit: "one-time" }
                ]
            },
            {
                name: "SJ",
                options: [
                    { label: "Hourly Rental (per hour)", rate: 29732, unit: "hour" },
                    { label: "8-Hour Rental (per day)", rate: 713556 / 3, unit: "8-hour" },
                    { label: "Daily Rental (24h)", rate: 713556, unit: "day" },
                    { label: "Monthly Rental", rate: 21704000, unit: "month" },
                    { label: "Yearly Rental", rate: 260448000, unit: "year" },
                    { label: "Purchase (5 Years)", rate: 1302240000, unit: "one-time" }
                ]
            }
        ];

        let selectedPrinter = null;
        let selectedPrinterOption = null;

        // Definisi komposisi material per batch dan volume batch
        // Material composition per batch and batch volume definition
        const MATERIAL_BATCH_COMPOSITION = {
            ink_powder: { kg: 20, volume_m3_in_batch: 0.04 },
            portland_cement: { kg: 20, volume_m3_in_batch: 0.03 },
            river_sand: { kg: 60, volume_m3_in_batch: 0.03 },
            plastic_tarpaulin: { unit: 2, volume_m3_in_batch: 0 },
            water: { liter: 14, volume_m3_in_batch: 0.05 },
            total_volume_per_batch_m3: 0.15
        };


        // Function to format numbers to Indonesian Rupiah currency
        function formatRupiah(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        // Function to format quantities (e.g., Kg, L, Unit)
        function formatQuantity(amount, unit) {
            if (typeof amount !== 'number' || isNaN(amount)) {
                return `N/A ${unit}`;
            }
            return `${amount.toFixed(2)} ${unit}`;
        }

        // Function to render printer cards dynamically
        function renderPrinterCards() {
            const printerCardsContainer = document.getElementById('printer_cards');
            printerCardsContainer.innerHTML = '';

            PRINTERS.forEach((printer, printerIndex) => {
                const printerCard = document.createElement('div');
                printerCard.className = 'printer-card';
                const pricingOptionsHtml = printer.options.map((option, optionIndex) => `
                    <div class="pricing-option" 
                        data-printer-index="${printerIndex}" 
                        data-option-index="${optionIndex}" 
                        onclick="selectPrinter('${printer.name}', ${printerIndex}, ${optionIndex})">
                        <div class="price-amount">${formatRupiah(option.rate)}</div>
                        <div class="price-label">${option.label}</div>
                    </div>
                `).join('');

                printerCard.innerHTML = `
                    <div class="printer-name">${printer.name}</div>
                    <div class="pricing-options">
                        ${pricingOptionsHtml}
                    </div>
                `;
                printerCardsContainer.appendChild(printerCard);
            });
        }

        // Function to select a printer and its pricing option
        function selectPrinter(printerName, printerIndex, optionIndex) {
            const allPrinterOptions = document.querySelectorAll('.pricing-option');
            allPrinterOptions.forEach(option => option.classList.remove('selected'));

            const selectedOptionElement = document.querySelector(`.pricing-option[data-printer-index="${printerIndex}"][data-option-index="${optionIndex}"]`);
            selectedOptionElement.classList.add('selected');

            const allPrinterCards = document.querySelectorAll('.printer-card');
            allPrinterCards.forEach(card => card.classList.remove('selected'));
            selectedOptionElement.closest('.printer-card').classList.add('selected');

            selectedPrinter = PRINTERS[printerIndex];
            selectedPrinterOption = selectedPrinter.options[optionIndex];
            
            document.getElementById('selected_printer_feedback').textContent = `Currently selected: ${selectedPrinter.name} - ${selectedPrinterOption.label}`;

            calculateAll();
        }

        // Function to calculate the 3D printer cost
        function calculatePrinterCost() {
            let total_volume = parseFloat(document.getElementById('total_volume').value) || 0;
            
            let printerCost = 0;
            let printerDescription = "Not Selected";

            if (selectedPrinter && selectedPrinterOption) {
                const rate = selectedPrinterOption.rate;
                const unit = selectedPrinterOption.unit;
                printerDescription = `${selectedPrinter.name} - ${selectedPrinterOption.label}`;

                const volume_per_batch_for_hours = 0.2;
                const time_per_batch_hours = 1;
                let total_project_hours_needed = 0;
                if (total_volume > 0 && volume_per_batch_for_hours > 0) {
                    total_project_hours_needed = (total_volume / volume_per_batch_for_hours) * time_per_batch_hours;
                }


                if (unit === "hour") {
                    printerCost = rate * total_project_hours_needed;
                } else if (unit === "8-hour") {
                    printerCost = (rate / 8) * total_project_hours_needed;
                } else if (unit === "day") {
                    printerCost = (rate / 24) * total_project_hours_needed;
                } else if (unit === "month") {
                    printerCost = (rate / (30 * 24)) * total_project_hours_needed;
                } else if (unit === "year") {
                    printerCost = (rate / (365 * 24)) * total_project_hours_needed;
                } else if (unit === "one-time") {
                    printerCost = rate;
                }
            }

            document.getElementById('selected_printer_summary').textContent = printerDescription;
            return printerCost;
        }

        // Function to calculate additional equipment and rentals cost
        function calculateEquipment() {
            let totalCost = 0;
            const equipmentRows = document.querySelectorAll('#equipment_tbody tr:not(.total-row):not(.subheader-row)'); 

            equipmentRows.forEach(row => {
                const checkbox = row.querySelector('.use-checkbox');
                const calculatedCell = row.querySelector('.calculated');

                if (!checkbox || checkbox.checked) {
                    const qtyInput = row.querySelector('input[data-cost-type="equipment-qty"]');
                    const rateInput = row.querySelector('input[data-cost-type="equipment-rate"]');
                    
                    let quantity = parseFloat(qtyInput ? qtyInput.value : 0) || 0;
                    let rate = parseFloat(rateInput ? rateInput.value : 0) || 0;
                    
                    const rowTotal = quantity * rate;
                    
                    if (calculatedCell) {
                        calculatedCell.textContent = formatRupiah(rowTotal);
                    }
                    totalCost += rowTotal;
                } else {
                    if (calculatedCell) {
                        calculatedCell.textContent = formatRupiah(0);
                    }
                }
            });
            document.getElementById('equipment_total').textContent = formatRupiah(totalCost);
            return totalCost;
        }

        // Function to update the independent ink extrusion cost display
        function updateInkExtrusionCostDisplay() {
            const ink_width_mm = parseFloat(document.getElementById('ink_width_mm').value) || 0;
            const ink_thickness_mm = parseFloat(document.getElementById('ink_thickness_mm').value) || 0;
            const contour_length_per_layer_mm = parseFloat(document.getElementById('contour_length_per_layer_mm').value) || 0;
            const layer_amount = parseFloat(document.getElementById('layer_amount').value) || 0;

            const total_extrusion_length_m = (contour_length_per_layer_mm * layer_amount) / 1000;
            document.getElementById('total_extrusion_length_m').textContent = `${total_extrusion_length_m.toFixed(2)} m`;

            const volume_per_meter_extrusion_m3 = (ink_width_mm / 1000) * (ink_thickness_mm / 1000) * 1;
            const calculated_volume_m3 = volume_per_meter_extrusion_m3 * total_extrusion_length_m;
            document.getElementById('calculated_volume_m3').textContent = `${calculated_volume_m3.toFixed(4)} m¬≥`;

            const inkExtrusionPricePerMeter = parseFloat(document.getElementById('ink_extrusion_cost_per_meter').value) || 0;
            const inkExtrusionTotalCost = inkExtrusionPricePerMeter * total_extrusion_length_m;
            document.getElementById('ink_extrusion_total_cost').textContent = formatRupiah(inkExtrusionTotalCost);
        }

        // Function to calculate raw materials cost (excluding independent ink extrusion)
        function calculateMaterials() {
            let totalCost = 0;
            const total_volume = parseFloat(document.getElementById('total_volume').value) || 0;
            
            const total_volume_per_batch_m3 = MATERIAL_BATCH_COMPOSITION.total_volume_per_batch_m3;

            document.getElementById('ink_powder_qty_per_m3').value = (MATERIAL_BATCH_COMPOSITION.ink_powder.kg / total_volume_per_batch_m3).toFixed(2);
            document.getElementById('cement_qty_per_m3').value = (MATERIAL_BATCH_COMPOSITION.portland_cement.kg / total_volume_per_batch_m3).toFixed(2);
            document.getElementById('sand_qty_per_m3').value = (MATERIAL_BATCH_COMPOSITION.river_sand.kg / total_volume_per_batch_m3).toFixed(2);
            document.getElementById('water_qty_per_m3').value = (MATERIAL_BATCH_COMPOSITION.water.liter / total_volume_per_batch_m3).toFixed(2);


            const materialRows = document.querySelectorAll('#materials_tbody tr:not(.total-row)');
            const materialQtySummaryTbody = document.getElementById('material_qty_summary_tbody');
            materialQtySummaryTbody.innerHTML = '';

            materialRows.forEach(row => {
                const checkbox = row.querySelector('.use-checkbox');
                const calculatedCostCell = row.querySelector('.calculated');
                const materialName = row.querySelector('td:nth-child(1)').textContent.trim();
                const qtyInput = row.querySelector('input[data-cost-type="material-qty"]');
                const unitTextElement = qtyInput ? qtyInput.nextSibling : null;
                const unitText = unitTextElement ? unitTextElement.textContent.trim() : 'Kg/Unit';

                if (!checkbox || checkbox.checked) {
                    const quantityPerM3 = parseFloat(qtyInput ? qtyInput.value : 0) || 0;
                    const priceInput = row.querySelector('input[data-cost-type="material-price"]');
                    const price = parseFloat(priceInput ? priceInput.value : 0) || 0;
                    
                    const rowCostTotal = quantityPerM3 * price * total_volume; 
                    
                    if (calculatedCostCell) {
                        calculatedCostCell.textContent = formatRupiah(rowCostTotal);
                    }
                    totalCost += rowCostTotal;

                    if (materialName !== 'Plastic/Tarpaulin') {
                        const totalQuantity = quantityPerM3 * total_volume;
                        const newQtySummaryRow = document.createElement('tr');
                        newQtySummaryRow.innerHTML = `
                            <td>${materialName}</td>
                            <td>${formatQuantity(quantityPerM3, unitText.split('/')[0].trim())}</td>
                            <td>${formatQuantity(totalQuantity, unitText.split('/')[0].trim())}</td>
                        `;
                        materialQtySummaryTbody.appendChild(newQtySummaryRow);
                    } else {
                        const totalQuantity = quantityPerM3 * total_volume;
                        const newQtySummaryRow = document.createElement('tr');
                        newQtySummaryRow.innerHTML = `
                            <td>${materialName}</td>
                            <td>${formatQuantity(quantityPerM3, unitText.split('/')[0].trim())}</td>
                            <td>${formatQuantity(totalQuantity, unitText.split('/')[0].trim())}</td>
                        `;
                        materialQtySummaryTbody.appendChild(newQtySummaryRow);
                    }

                } else {
                    if (calculatedCostCell) {
                        calculatedCostCell.textContent = formatRupiah(0);
                    }
                    const newQtySummaryRow = document.createElement('tr');
                    newQtySummaryRow.classList.add('disabled-row');
                    newQtySummaryRow.innerHTML = `
                        <td>${materialName}</td>
                        <td>${formatQuantity(0, unitText.split('/')[0].trim())}</td>
                        <td>${formatQuantity(0, unitText.split('/')[0].trim())}</td>
                    `;
                    materialQtySummaryTbody.appendChild(newQtySummaryRow);
                }
            });

            const materialsTotalQty = calculateMaterialTotalQuantity();
            const totalQtySummaryRow = document.createElement('tr');
            totalQtySummaryRow.classList.add('total-row');
            totalQtySummaryRow.innerHTML = `
                <td colspan="2"><strong>Total Kuantitas Material</strong></td>
                <td class="calculated" id="all_materials_total_qty">${formatQuantity(materialsTotalQty, 'Kg')}</td>
            `;
            materialQtySummaryTbody.appendChild(totalQtySummaryRow);


            document.getElementById('materials_total').textContent = formatRupiah(totalCost);
            return totalCost;
        }

        // New function to calculate total quantity of materials (sum of all Kgs/Units)
        function calculateMaterialTotalQuantity() {
            let totalCombinedQuantity = 0;
            const total_volume = parseFloat(document.getElementById('total_volume').value) || 0;

            const materialRows = document.querySelectorAll('#materials_tbody tr:not(.total-row)');
            materialRows.forEach(row => {
                const checkbox = row.querySelector('.use-checkbox');
                if (!checkbox || checkbox.checked) {
                    const materialName = row.querySelector('td:nth-child(1)').textContent.trim();
                    const qtyInput = row.querySelector('input[data-cost-type="material-qty"]');
                    const quantityPerM3 = parseFloat(qtyInput ? qtyInput.value : 0) || 0;
                    
                    if (materialName !== 'Plastic/Tarpaulin') {
                        totalCombinedQuantity += (quantityPerM3 * total_volume);
                    }
                }
            });
            return totalCombinedQuantity;
        }


        // Function to calculate labor cost
        function calculateLabor() {
            let totalCost = 0;
            const laborRows = document.querySelectorAll('#labor_tbody tr:not(.total-row)');
            let project_duration = parseFloat(document.getElementById('project_duration').value) || 0;

            laborRows.forEach(row => {
                const checkbox = row.querySelector('.use-checkbox');
                const calculatedCell = row.querySelector('.calculated');

                if (!checkbox || checkbox.checked) {
                    const qtyInput = row.querySelector('input[data-cost-type="labor-qty"]');
                    const timeInput = row.querySelector('input[data-cost-type="labor-time"]');
                    const rateInput = row.querySelector('input[data-cost-type="labor-rate"]');

                    let quantity = parseFloat(qtyInput ? qtyInput.value : 0) || 0;
                    let timePerDayMinutes = parseFloat(timeInput ? timeInput.value : 0) || 0;
                    let ratePerHour = parseFloat(rateInput ? rateInput.value : 0) || 0;
                    
                    const hoursPerDay = timePerDayMinutes / 60;
                    const dailyCostPerPerson = hoursPerDay * ratePerHour;
                    const projectTotalCost = quantity * dailyCostPerPerson * project_duration;

                    if (calculatedCell) {
                        calculatedCell.textContent = formatRupiah(projectTotalCost);
                    }
                    totalCost += projectTotalCost;
                } else {
                    if (calculatedCell) {
                        calculatedCell.textContent = formatRupiah(0);
                    }
                }
            });
            document.getElementById('labor_total').textContent = formatRupiah(totalCost);
            return totalCost;
        }

        // Function to calculate reinforcing bar cost
        function calculateRebar() {
            let totalCost = 0;
            const rebarRows = document.querySelectorAll('#rebar_tbody tr:not(.total-row)');

            rebarRows.forEach(row => {
                const checkbox = row.querySelector('.use-checkbox');
                const lengthInput = row.querySelector('input[data-cost-type="rebar-length"]');
                const pricePerMeterInput = row.querySelector('input[data-cost-type="rebar-price-per-meter"]');
                const calculatedCell = row.querySelector('.calculated');

                if (!checkbox || checkbox.checked) {
                    const length = parseFloat(lengthInput ? lengthInput.value : 0) || 0;
                    const pricePerMeter = parseFloat(pricePerMeterInput ? pricePerMeterInput.value : 0) || 0;
                    
                    const rowTotal = length * pricePerMeter;
                    
                    if (calculatedCell) {
                        calculatedCell.textContent = formatRupiah(rowTotal);
                    }
                    totalCost += rowTotal;
                } else {
                    if (calculatedCell) {
                        calculatedCell.textContent = formatRupiah(0);
                    }
                }
            });
            document.getElementById('rebar_total').textContent = formatRupiah(totalCost);
            return totalCost;
        }

        // Function to toggle row and input states based on checkbox
        function toggleRow(checkbox) {
            const row = checkbox.closest('tr');
            const inputs = row.querySelectorAll('input.editable'); 
            
            if (checkbox.checked) {
                row.classList.remove('disabled-row');
                inputs.forEach(input => {
                    if (input.type === 'number' && input.dataset.originalValue && parseFloat(input.value) === 0 && !input.readOnly) {
                        input.value = input.dataset.originalValue;
                        delete input.dataset.originalValue;
                    }
                    input.removeAttribute('disabled');
                });
            } else {
                row.classList.add('disabled-row');
                inputs.forEach(input => {
                    if (input.type === 'number' && input.value !== "0" && !input.readOnly) {
                        input.dataset.originalValue = input.value;
                    }
                    input.setAttribute('disabled', 'true');
                    if (input.type === 'number' && !input.readOnly) {
                        input.value = 0;
                    }
                });
            }
            calculateAll();
        }

        // Functions for adding new rows dynamically
        function addMaterialRow() {
            const tbody = document.getElementById('materials_tbody');
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td><input type="text" class="editable" value="New Material" data-cost-type="material-name" onchange="calculateAll()"></td>
                <td><input type="text" class="editable" value="Custom Description" data-cost-type="material-desc" onchange="calculateAll()"></td>
                <td><input type="number" class="editable" data-cost-type="material-qty" value="1" step="0.1" onchange="calculateAll()"> Kg/m¬≥</td>
                <td><input type="number" class="editable" data-cost-type="material-price" value="1000" onchange="calculateAll()"> Rp/Kg</td>
                <td><input type="checkbox" class="use-checkbox" checked onchange="toggleRow(this)"></td>
                <td class="calculated"></td>
            `;
            const totalRow = tbody.querySelector('.total-row');
            if (totalRow) {
                tbody.insertBefore(newRow, totalRow);
            } else {
                tbody.appendChild(newRow);
            }
            updateTotalColspan('materials_tbody'); 
            calculateAll();
        }

        function addRebarRow() {
            const tbody = document.getElementById('rebar_tbody');
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td><input type="text" class="editable" value="New Rebar" data-cost-type="rebar-name" onchange="calculateAll()"></td>
                <td><input type="text" class="editable" value="Custom Description" data-cost-type="rebar-desc" onchange="calculateAll()"></td>
                <td><input type="number" class="editable" data-cost-type="rebar-length" value="10" step="0.1" onchange="calculateAll()"></td>
                <td>Meter</td>
                <td><input type="number" class="editable" data-cost-type="rebar-price-per-meter" value="7000" onchange="calculateAll()"></td>
                <td><input type="checkbox" class="use-checkbox" checked onchange="toggleRow(this)"></td>
                <td class="calculated"></td>
            `;
            const totalRow = tbody.querySelector('.total-row');
            if (totalRow) {
                tbody.insertBefore(newRow, totalRow);
            } else {
                tbody.appendChild(newRow);
            }
            updateTotalColspan('rebar_tbody'); 
            calculateAll();
        }

        function addEquipmentRow() {
            const tbody = document.getElementById('equipment_tbody');
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td><input type="text" class="editable" value="New Equipment" data-cost-type="equipment-name" onchange="calculateAll()"></td>
                <td><input type="number" class="editable" data-cost-type="equipment-qty" value="1" onchange="calculateAll()"></td>
                <td>Unit</td>
                <td><input type="number" class="editable" data-cost-type="equipment-rate" value="100000" onchange="calculateAll()"></td>
                <td><input type="checkbox" class="use-checkbox" checked onchange="toggleRow(this)"></td>
                <td class="calculated"></td>
            `;
            const totalRow = tbody.querySelector('.total-row');
            if (totalRow) {
                tbody.insertBefore(newRow, totalRow);
            } else {
                tbody.appendChild(newRow);
            }
            updateTotalColspan('equipment_tbody'); 
            calculateAll();
        }

        function addLaborRow() {
            const tbody = document.getElementById('labor_tbody');
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td><input type="text" class="editable" value="New Worker" data-cost-type="labor-name" onchange="calculateAll()"></td>
                <td>Custom Task</td>
                <td><input type="number" class="editable" data-cost-type="labor-qty" value="1" onchange="calculateAll()"></td>
                <td><input type="number" class="editable" data-cost-type="labor-time" value="480" onchange="calculateAll()"></td>
                <td><input type="number" class="editable" data-cost-type="labor-rate" value="20000" onchange="calculateAll()"></td>
                <td><input type="checkbox" class="use-checkbox" checked onchange="toggleRow(this)"></td>
                <td class="calculated"></td>
            `;
            const totalRow = tbody.querySelector('.total-row');
            if (totalRow) {
                tbody.insertBefore(newRow, totalRow);
            } else {
                tbody.appendChild(newRow);
            }
            updateTotalColspan('labor_tbody'); 
            calculateAll();
        }

        // Function to dynamically update colspan for total rows
        function updateTotalColspan(tbodyId) {
            const tbody = document.getElementById(tbodyId);
            const totalRow = tbody.querySelector('.total-row');
            if (totalRow) {
                const totalTextCell = totalRow.querySelector('td:first-child');
                const exampleRow = tbody.querySelector('tr:not(.total-row):not(.subheader-row)');
                if (exampleRow) {
                    const numDataCellsInRow = exampleRow.querySelectorAll('td').length;
                    totalTextCell.setAttribute('colspan', numDataCellsInRow - 1);
                } else {
                    const numHeaders = tbody.closest('table').querySelectorAll('thead th').length;
                    totalTextCell.setAttribute('colspan', numHeaders - 1);
                }
            }
        }


        // Main function to calculate all costs and update the summary
        function calculateAll() {
            // --- Calculate Total Volume from L, W, H ---
            const length_mm = parseFloat(document.getElementById('length_mm').value) || 0;
            const width_mm = parseFloat(document.getElementById('width_mm').value) || 0;
            const height_mm = parseFloat(document.getElementById('height_mm').value) || 0;

            let total_volume_calculated_m3 = (length_mm / 1000) * (width_mm / 1000) * (height_mm / 1000);
            
            document.getElementById('total_volume').value = total_volume_calculated_m3.toFixed(4);
            document.getElementById('display_volume').textContent = total_volume_calculated_m3.toFixed(2);

            let total_volume = total_volume_calculated_m3;


            // --- Otomatisasi Project Duration ---
            const volume_per_batch_for_hours = 0.2;
            const time_per_batch_hours = 1;
            const daily_operating_hours = parseFloat(document.getElementById('daily_operating_hours').value) || 0;

            let calculated_project_duration_days = 0;
            let total_hours_needed_for_project = 0;

            if (total_volume > 0 && volume_per_batch_for_hours > 0) {
                total_hours_needed_for_project = (total_volume / volume_per_batch_for_hours) * time_per_batch_hours;
                if (daily_operating_hours > 0) {
                    calculated_project_duration_days = total_hours_needed_for_project / daily_operating_hours;
                } else {
                    calculated_project_duration_days = total_hours_needed_for_project / 8;
                }
            }
            
            document.getElementById('project_duration').value = calculated_project_duration_days.toFixed(2);

            const total_minutes_needed_for_project = total_hours_needed_for_project * 60;
            const display_hours = Math.floor(total_minutes_needed_for_project / 60);
            const display_minutes = Math.round(total_minutes_needed_for_project % 60);
            document.getElementById('project_duration_hours_minutes').textContent = `(${display_hours} hours, ${display_minutes} minutes)`;


            updateInkExtrusionCostDisplay();


            const printer_cost = calculatePrinterCost();
            const equipment_total = calculateEquipment();
            const materials_total = calculateMaterials();
            const labor_total = calculateLabor();
            const rebar_total = calculateRebar(); 

            const grand_total_project = printer_cost + equipment_total + materials_total + labor_total + rebar_total;
            
            let cost_per_cubic = 0;
            if (total_volume > 0) {
                cost_per_cubic = grand_total_project / total_volume;
            }

            document.getElementById('cost_per_cubic').textContent = formatRupiah(cost_per_cubic);

            document.getElementById('printer_per_cubic').textContent = formatRupiah(printer_cost / (total_volume > 0 ? total_volume : 1));
            document.getElementById('printer_project_total').textContent = formatRupiah(printer_cost);

            document.getElementById('equipment_per_cubic').textContent = formatRupiah(equipment_total / (total_volume > 0 ? total_volume : 1));
            document.getElementById('equipment_project_total').textContent = formatRupiah(equipment_total);

            document.getElementById('materials_per_cubic').textContent = formatRupiah(materials_total / (total_volume > 0 ? total_volume : 1)); 
            document.getElementById('materials_project_total').textContent = formatRupiah(materials_total);

            document.getElementById('labor_per_cubic').textContent = formatRupiah(labor_total / (total_volume > 0 ? total_volume : 1));
            document.getElementById('labor_project_total').textContent = formatRupiah(labor_total); 

            document.getElementById('rebar_per_cubic').textContent = formatRupiah(rebar_total / (total_volume > 0 ? total_volume : 1));
            document.getElementById('rebar_project_total').textContent = formatRupiah(rebar_total);

            document.getElementById('grand_total_per_cubic').textContent = formatRupiah(cost_per_cubic);
            document.getElementById('grand_total_project').textContent = formatRupiah(grand_total_project);

            updatePercentages(grand_total_project, printer_cost, equipment_total, materials_total, labor_total, rebar_total);
        }

        // Function to update percentages in the summary table
        function updatePercentages(grandTotal, printerCost, equipmentCost, materialsCost, laborCost, rebarCost) {
            if (grandTotal === 0) {
                document.getElementById('printer_percentage').textContent = '0%';
                document.getElementById('equipment_percentage').textContent = '0%';
                document.getElementById('materials_percentage').textContent = '0%';
                document.getElementById('labor_percentage').textContent = '0%';
                document.getElementById('rebar_percentage').textContent = '0%';
                document.getElementById('grand_total_percentage').textContent = '0%'; 
                return;
            }

            document.getElementById('printer_percentage').textContent = ((printerCost / grandTotal) * 100).toFixed(1) + '%';
            document.getElementById('equipment_percentage').textContent = ((equipmentCost / grandTotal) * 100).toFixed(1) + '%';
            document.getElementById('materials_percentage').textContent = ((materialsCost / grandTotal) * 100).toFixed(1) + '%';
            document.getElementById('labor_percentage').textContent = ((laborCost / grandTotal) * 100).toFixed(1) + '%';
            document.getElementById('rebar_percentage').textContent = ((rebarCost / grandTotal) * 100).toFixed(1) + '%';
            document.getElementById('grand_total_percentage').textContent = '100%'; 
        }

        // Initialize calculations on page load
        document.addEventListener('DOMContentLoaded', () => {
            renderPrinterCards();
            selectPrinter(PRINTERS[0].name, 0, 0); 
            updateProjectNameForPrint();
            updateTotalColspan('materials_tbody');
            updateTotalColspan('rebar_tbody');
            updateTotalColspan('equipment_tbody');
            updateTotalColspan('labor_tbody');
        });
    </script>
</body>
</html>
